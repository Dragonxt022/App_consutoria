<div class="max-w-4xl mx-auto">
    <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-slate-50 p-6 border-b border-slate-100 flex items-center justify-between">
            <div>
                <h2 class="text-xl font-bold text-slate-800">Editar Curso</h2>
                <p class="text-slate-500 text-sm">Atualize os detalhes técnicos do treinamento presencial.</p>
            </div>
            <div class="flex items-center space-x-2">
                <span class="text-xs font-bold uppercase tracking-widest text-slate-400">Status Atual:</span>
                <% if(course.active) { %>
                    <span class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-emerald-200">Ativo</span>
                <% } else { %>
                    <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-red-200">Desativado</span>
                <% } %>
            </div>
        </div>

        <form action="/admin/cursos/<%= course.id %>/editar" method="POST" enctype="multipart/form-data" class="p-8 space-y-8">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Informações Básicas -->
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Nome do Curso</label>
                        <input type="text" name="title" value="<%= course.title %>" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="Ex: Gestão Estratégica 4.0">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Descrição Curta</label>
                        <textarea name="description" rows="4" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="Resumo do que será abordado no curso..."><%= course.description %></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Investimento (R$)</label>
                            <input type="text" name="price" value="<%= course.price %>" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="R$ 1.200,00">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Vagas Disponíveis</label>
                            <input type="number" name="spots" value="<%= course.spots %>" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="20">
                        </div>
                    </div>

                    <div class="pt-4">
                        <label class="flex items-center space-x-3 text-sm font-bold text-slate-700 cursor-pointer p-4 bg-slate-50 rounded-xl border border-slate-100 hover:bg-slate-100 transition-all">
                            <input type="checkbox" name="active" <%= course.active ? 'checked' : '' %> class="w-5 h-5 text-emerald-600 rounded border-slate-300 focus:ring-emerald-500">
                            <span>Curso visível e aberto para inscrições</span>
                        </label>
                        <p class="text-[10px] text-slate-400 mt-2 px-1">Ao desmarcar, o curso deixará de aparecer na página inicial e detalhes.</p>
                    </div>
                </div>

                <!-- Logística e Detalhes -->
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Local do Treinamento</label>
                        <input type="text" name="location" value="<%= course.location %>" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="Ex: Hotel Hilton, São Paulo - SP">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Data de Início</label>
                            <% 
                                let dateVal = '';
                                if(course.startDate) {
                                    const d = new Date(course.startDate);
                                    dateVal = d.toISOString().split('T')[0];
                                }
                            %>
                            <input type="date" name="startDate" value="<%= dateVal %>" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Carga Horária</label>
                            <input type="text" name="workload" value="<%= course.workload %>" required class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="Ex: 40 horas">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">O que está incluso?</label>
                        <div class="space-y-3 mt-4">
                            <% 
                                const includesMaterial = course.itemsIncluded && course.itemsIncluded.includes('Material didático completo');
                                const includesCoffee = course.itemsIncluded && course.itemsIncluded.includes('Coffee break premium');
                                const includesCert = course.itemsIncluded && course.itemsIncluded.includes('Certificado impresso');
                            %>
                            <label class="flex items-center space-x-3 text-sm text-slate-600 cursor-pointer">
                                <input type="checkbox" name="includes_material" <%= includesMaterial ? 'checked' : '' %> class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span>Material didático completo</span>
                            </label>
                            <label class="flex items-center space-x-3 text-sm text-slate-600 cursor-pointer">
                                <input type="checkbox" name="includes_coffee" <%= includesCoffee ? 'checked' : '' %> class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span>Coffee break premium</span>
                            </label>
                            <label class="flex items-center space-x-3 text-sm text-slate-600 cursor-pointer">
                                <input type="checkbox" name="includes_cert" <%= includesCert ? 'checked' : '' %> class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span>Certificado impresso</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Uploads -->
            <div class="pt-8 border-t border-slate-100 flex flex-col md:flex-row gap-8">
                <!-- Imagem de Capa -->
                <div class="flex-1">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Imagem de Capa</label>
                    <div class="relative border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center hover:border-indigo-400 transition-all">
                        <input type="file" name="image" id="imageInput" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        
                        <!-- Preview da Imagem -->
                        <div id="imagePreview" class="<%= course.image ? '' : 'hidden' %> mb-4">
                            <div class="relative inline-block">
                                <img id="previewImage" class="max-h-48 mx-auto rounded-lg shadow-md" src="<%= course.image ? course.image : '#' %>" alt="Pré-visualização da imagem">
                                <button type="button" id="removeImage" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition-colors">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Placeholder -->
                        <div id="imagePlaceholder" class="<%= course.image ? 'hidden' : '' %>">
                            <svg class="w-10 h-10 text-slate-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p class="text-xs text-slate-500">Arraste ou clique para selecionar (JPG, PNG)</p>
                            <p class="text-xs text-slate-400 mt-1">Recomendado: 1200x630 pixels</p>
                        </div>
                    </div>
                </div>
                
                <!-- Proposta do Curso -->
                <div class="flex-1">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Proposta do Curso (PDF/DOC)</label>
                    <div class="relative border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center hover:border-indigo-400 transition-all">
                        <input type="file" name="proposalDoc" id="pdfInput" accept=".pdf,.doc,.docx,.txt" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        
                        <!-- Preview do PDF -->
                        <div id="pdfPreview" class="<%= course.proposalDoc ? '' : 'hidden' %> mb-4">
                            <div class="bg-slate-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3 overflow-hidden">
                                        <svg class="w-8 h-8 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                        </svg>
                                        <div class="overflow-hidden">
                                            <p id="pdfFileName" class="text-sm font-medium text-slate-700 truncate max-w-xs">
                                                <%= course.proposalDoc ? course.proposalDoc.split('/').pop() : '' %>
                                            </p>
                                            <p id="pdfFileSize" class="text-xs text-slate-500">Arquivo atual</p>
                                        </div>
                                    </div>
                                    <button type="button" id="removePdf" class="text-red-500 hover:text-red-600 flex-shrink-0">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Placeholder -->
                        <div id="pdfPlaceholder" class="<%= course.proposalDoc ? 'hidden' : '' %>">
                            <svg class="w-10 h-10 text-slate-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            <p class="text-xs text-slate-500">Selecione o documento da proposta</p>
                            <p class="text-xs text-slate-400 mt-1">Formatos aceitos: PDF, DOC, DOCX, TXT</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-4 pt-4">
                <a href="/admin/cursos" class="px-6 py-3 text-slate-600 font-bold text-sm">Cancelar</a>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-10 py-3 rounded-xl text-sm font-bold shadow-lg shadow-indigo-100 transform active:scale-95 transition-all">
                    Salvar Alterações
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elementos da imagem
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const previewImage = document.getElementById('previewImage');
    const imagePlaceholder = document.getElementById('imagePlaceholder');
    const removeImageBtn = document.getElementById('removeImage');
    
    // Elementos do PDF
    const pdfInput = document.getElementById('pdfInput');
    const pdfPreview = document.getElementById('pdfPreview');
    const pdfFileName = document.getElementById('pdfFileName');
    const pdfFileSize = document.getElementById('pdfFileSize');
    const pdfPlaceholder = document.getElementById('pdfPlaceholder');
    const removePdfBtn = document.getElementById('removePdf');
    
    // Manipulação da imagem
    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Verifica se é uma imagem
            if (!file.type.match('image.*')) {
                alert('Por favor, selecione apenas arquivos de imagem.');
                imageInput.value = '';
                return;
            }
            
            // Verifica o tamanho (máximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('A imagem não pode ter mais de 5MB.');
                imageInput.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                imagePreview.classList.remove('hidden');
                imagePlaceholder.classList.add('hidden');
            }
            reader.readAsDataURL(file);
        }
    });
    
    // Remover imagem
    removeImageBtn.addEventListener('click', function() {
        imageInput.value = '';
        previewImage.src = '#';
        imagePreview.classList.add('hidden');
        imagePlaceholder.classList.remove('hidden');
    });
    
    // Manipulação do PDF
    pdfInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Verifica a extensão
            const validExtensions = ['.pdf', '.doc', '.docx', '.txt'];
            const fileName = file.name.toLowerCase();
            const isValid = validExtensions.some(ext => fileName.endsWith(ext));
            
            if (!isValid) {
                alert('Por favor, selecione apenas arquivos PDF, DOC, DOCX ou TXT.');
                pdfInput.value = '';
                return;
            }
            
            // Verifica o tamanho (máximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('O documento não pode ter mais de 10MB.');
                pdfInput.value = '';
                return;
            }
            
            // Mostra informações do arquivo
            pdfFileName.textContent = file.name;
            
            // Formata o tamanho do arquivo
            const fileSize = file.size;
            let sizeText;
            if (fileSize < 1024) {
                sizeText = fileSize + ' bytes';
            } else if (fileSize < 1024 * 1024) {
                sizeText = (fileSize / 1024).toFixed(1) + ' KB';
            } else {
                sizeText = (fileSize / (1024 * 1024)).toFixed(1) + ' MB';
            }
            pdfFileSize.textContent = sizeText;
            
            pdfPreview.classList.remove('hidden');
            pdfPlaceholder.classList.add('hidden');
        }
    });
    
    // Remover PDF
    removePdfBtn.addEventListener('click', function() {
        pdfInput.value = '';
        pdfFileName.textContent = '';
        pdfFileSize.textContent = '';
        pdfPreview.classList.add('hidden');
        pdfPlaceholder.classList.remove('hidden');
    });
    
    // Drag and Drop para a imagem
    const imageDropArea = imageInput.parentElement;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        imageDropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        imageDropArea.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        imageDropArea.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        imageDropArea.classList.add('border-indigo-500', 'bg-indigo-50');
    }
    
    function unhighlight() {
        imageDropArea.classList.remove('border-indigo-500', 'bg-indigo-50');
    }
    
    imageDropArea.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        imageInput.files = files;
        
        // Dispara o evento change manualmente
        const event = new Event('change');
        imageInput.dispatchEvent(event);
    }
    
    // Drag and Drop para o PDF (similar)
    const pdfDropArea = pdfInput.parentElement;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        pdfDropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    ['dragenter', 'dragover'].forEach(eventName => {
        pdfDropArea.addEventListener(eventName, () => {
            pdfDropArea.classList.add('border-indigo-500', 'bg-indigo-50');
        }, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        pdfDropArea.addEventListener(eventName, () => {
            pdfDropArea.classList.remove('border-indigo-500', 'bg-indigo-50');
        }, false);
    });
    
    pdfDropArea.addEventListener('drop', function(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        pdfInput.files = files;
        
        const event = new Event('change');
        pdfInput.dispatchEvent(event);
    }, false);
});
</script>
